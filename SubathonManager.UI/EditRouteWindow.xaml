<ui:FluentWindow x:Class="SubathonManager.UI.EditRouteWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:local="clr-namespace:SubathonManager.UI"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 mc:Ignorable="d"
                 Background="{DynamicResource UiBrushPrimary}"
                 ResizeMode="NoResize"
                 WindowStartupLocation="CenterOwner"
                 Title="EditRouteWindow" Height="900" Width="1740">
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="370"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="370"/>
        </Grid.ColumnDefinitions>
        
        
        <ui:TitleBar Title="Overlay Editor" Grid.ColumnSpan="3"
                     Icon="Assets/appicon.ico"
                     ShowMinimize="True"
                     Background="#101010"
                     ShowMaximize="True"
                     ShowClose="True"
                     DockPanel.Dock="Top"/>
        
        <!-- LEFT - widget list and route settings -->
        <StackPanel Grid.Column="0" Margin="12 44 12 12" >

            <StackPanel Orientation="Vertical" Background="{DynamicResource UiBrushControlBackground}">
                <TextBlock Text="Overlay" FontWeight="SemiBold" Margin="0,12,0,8"/>
                <TextBlock Text="Name" FontSize="12" />
                <TextBox x:Name="RouteNameBox" Margin="0,4,0,8"/>
                <StackPanel Orientation="Horizontal">
                    <StackPanel>
                        <TextBlock Text="Width" FontSize="12"/>
                        <TextBox x:Name="RouteWidthBox" Width="120" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="Height" FontSize="12"/>
                        <TextBox x:Name="RouteHeightBox" Width="120" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                    <ui:Button Padding="2"
                               ToolTip="Copy URL to clipboard"
                               Width="32" Height="32"
                               Margin="4,0,4,0"
                               Click="CopyOverlayUrl_Click"><ui:SymbolIcon Symbol="Link24" />
                    </ui:Button>

                    <ui:Button Padding="2" ToolTip="Open in browser"
                               Width="32" Height="32"
                               Margin="4,0,194,0"
                               Click="OpenOverlayInBrowser_Click"><ui:SymbolIcon Symbol="Open24"/>
                    </ui:Button>
                    <ui:Button x:Name="SaveRouteButton" Content="Save" Width="80" Click="SaveRouteButton_Click"/>
                </StackPanel>
            </StackPanel>

            <Separator Margin="0,12"/>

            <!-- Widgets -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                <TextBlock Text="Widgets" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                <ui:Button x:Name="ImportWidgetButton" Padding="2" Icon="Add20" Content="Import Widget" Margin="8,0,0,0" Click="ImportWidgetButton_Click"/>
            </StackPanel>

            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="WidgetsList" >
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <ui:Card x:Name="WidgetCard"  MouseDoubleClick="WidgetCard_MouseDoubleClick" Margin="0,0,0,8" Padding="10" Background="{DynamicResource UiBrushControlBackground}">
                                <ui:Card.Triggers>
                                    <EventTrigger RoutedEvent="MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="WidgetActions"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="1" Duration="0:0:0.15"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="WidgetActions"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0" Duration="0:0:0.15"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </ui:Card.Triggers>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Z, StringFormat=Z: {0}}" FontSize="11" Foreground="{DynamicResource UiBrushTextTertiary}"/>
                                    </StackPanel>

                                    <StackPanel x:Name="WidgetActions" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Opacity="0">
                                        <ui:Button Padding="2" Margin="2 0 2 0" ToolTip="Move Up" Click="MoveUp_Click" Width="30" Height="30" Appearance="Primary">
                                            <ui:SymbolIcon Symbol="ChevronUp20"/>
                                        </ui:Button>
                                        <ui:Button Padding="2" Margin="2 0 2 0" ToolTip="Move Down" Click="MoveDown_Click" Width="30" Height="30" Appearance="Primary">
                                            <ui:SymbolIcon Symbol="ChevronDown20"/>
                                        </ui:Button>
                                        <ui:Button Padding="2" Margin="2 0 2 0" ToolTip="Edit" Click="EditWidget_Click" Width="30" Height="30" Appearance="Secondary">
                                            <ui:SymbolIcon Symbol="Edit20"/>
                                        </ui:Button>
                                        <ui:Button Padding="2" Margin="2 0 2 0" ToolTip="Copy" Click="CopyWidget_Click" Width="30" Height="30" Appearance="Secondary">
                                            <ui:SymbolIcon Symbol="Copy20"/>
                                        </ui:Button>
                                        <ui:Button Padding="2" Margin="2 0 2 0" ToolTip="Delete" Click="DeleteWidget_Click" Width="30" Height="30" Appearance="Danger">
                                            <ui:SymbolIcon Symbol="Delete20"/>
                                        </ui:Button>
                                    </StackPanel>
                                </Grid>
                            </ui:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </StackPanel>
        
        <!-- MIDDLE - webview editor -->
        <Grid Grid.Column="1" Margin="12 40 12 12"> 
            <Border Background="{DynamicResource UiBrushSurface}" CornerRadius="8" Padding="6">
                
                <Grid x:Name="WebViewContainer" Background="Black">
                <wv2:WebView2 x:Name="PreviewWebView" 
                              xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch" 
                              Width="{Binding _route.Width}" 
                              Height="{Binding _route.Height}"
                              DefaultBackgroundColor="White"/>
                </Grid>
            </Border>
        </Grid>
        
        <!-- RIGHT - widget editor -->
        <Border Grid.Column="2" Background="{DynamicResource UiBrushPrimary}" Padding="0 12 12 12">
            <StackPanel x:Name="WidgetEditorPanel" VerticalAlignment="Stretch">

                <StackPanel x:Name="EmptyEditorPanel">
                    <TextBlock Text="Widget Editor" FontWeight="SemiBold" Margin="0,44,0,8"/>
                    <TextBlock Text="Please select a widget to edit in the left column." 
                               Foreground="Gray" FontSize="13"/>
                </StackPanel>

                <StackPanel x:Name="WidgetEditPanel" Visibility="Collapsed" VerticalAlignment="Stretch">
                    <TextBlock Text="Widget Editor" FontSize="18" FontWeight="Bold" Margin="0,0,0,8"/>
                    
                    <StackPanel Margin="0,8">
                        <TextBlock Text="Name" FontWeight="SemiBold"/>
                        <TextBox x:Name="WidgetNameBox"/>
                    </StackPanel>

                    <UniformGrid Columns="2" Rows="2" Margin="0,8">
                        <StackPanel>
                            <TextBlock Text="Width" FontWeight="SemiBold"/>
                            <TextBox x:Name="WidgetWidthBox" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Height" FontWeight="SemiBold"/>
                            <TextBox x:Name="WidgetHeightBox" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="X" FontWeight="SemiBold"/>
                            <TextBox x:Name="WidgetXBox" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Y" FontWeight="SemiBold"/>
                            <TextBox x:Name="WidgetYBox" PreviewTextInput="NumberOnly_PreviewTextInput"/>
                        </StackPanel>
                    </UniformGrid>

                    <Separator Margin="0,10"/>

                    <!-- CSS Variables -->
                    <TextBlock Text="CSS Variables" FontWeight="Bold" Margin="0,0,0,6"/>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="250">
                        <ItemsControl x:Name="CssVarsList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,2">
                                        <TextBlock Text="{Binding Name}" Width="120"/>
                                        <TextBox Text="{Binding Value}" Width="180"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <Button Content="Save" Width="100" Margin="0,12,0,0" Click="SaveWidgetButton_Click"/>
                </StackPanel>
            </StackPanel>
        </Border>

    </Grid>
</ui:FluentWindow>
