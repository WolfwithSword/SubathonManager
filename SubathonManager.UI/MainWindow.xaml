<ui:FluentWindow x:Class="SubathonManager.UI.MainWindow"
                       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                       xmlns:views="clr-namespace:SubathonManager.UI.Views"
                       xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                       mc:Ignorable="d"
                       Background="{DynamicResource UiBrushPrimary}"
                       ResizeMode="NoResize"
                       WindowStartupLocation="CenterScreen"
                       Title="Subathon Manager" Height="800" Width="1200">
    
    <Grid>
        <ui:TitleBar Title="Subathon Manager"
                     x:Name="TitleBar"
                     Icon="Assets/appicon.ico"
                     ShowMinimize="True"
                     Background="#101010"
                     ShowMaximize="False"
                     ShowClose="True"
                     DockPanel.Dock="Top"/>
        <TabControl Margin="0,40,0,0">
            <!-- Home Tab -->
            <TabItem Header="Home">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="500"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                   <!-- <ScrollViewer Grid.Column="0" >-->
                    <StackPanel  Grid.Column="0" Margin="10">
                        <TextBlock Text="Welcome to Subathon Manager!" 
                                   FontSize="22" FontWeight="Bold" Margin="0,0,0,10"/>
                        <TextBlock Text="Use the Overlays tab to manage your overlays and widgets, and the Settings tab to configure your settings." 
                                   TextWrapping="Wrap" FontSize="16" Margin="0 0 0 6"/>
                        <Separator Margin="4 12 4 8"/>
                        <TextBlock Text="Recent Events" HorizontalAlignment="Left" Margin="18 8 4 8"/>
                        <views:EventListView Margin="0 8 0 0 "/>
                    </StackPanel>
                   <StackPanel Grid.Column="1" Margin="34 2 10 10">
                       <Grid>
                           <Grid.RowDefinitions>
                               <RowDefinition Height="300"/>
                               <RowDefinition Height="*"/>
                           </Grid.RowDefinitions>
                           <StackPanel Grid.Row="0" Margin="10 2 10 10">
                               <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,16,5">
                                   <ui:Button x:Name="StartSubathonBtn" 
                                                      Click="StartNewSubathon_Click"
                                                      Content="Start New Subathon"
                                                      Width="220" Height="30" Margin="0,2,20,5"/>
                                   <TextBlock Text="Initial Time:" Width="80" VerticalAlignment="Center" Margin="18 2 6 5"/>
                                   <ui:TextBox x:Name="InitialSubathonTime" Text="8h" Width="140" VerticalAlignment="Center" Margin="0 2 0 5"/>
                               </StackPanel>
                               
                               <Grid Margin="124 0 0 0 ">
                                   
                                   <Grid.ColumnDefinitions>
                                       <ColumnDefinition Width="250"/>
                                       <ColumnDefinition Width="*"/>
                                   </Grid.ColumnDefinitions>
                                   <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" Margin="12,0,16,5">
                                       <ui:Button x:Name="TogglePauseTimerBtn"
                                                  Click="TogglePauseSubathon_Click"
                                                  Padding="2"
                                                  Width="50" Height="50" Margin="0,10,6,5">
                                           <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                               <ui:SymbolIcon x:Name="PauseIcon" Symbol="Pause28" Width="54" Height="44" Margin="0"/>
                                               <!-- <TextBlock x:Name="PauseText" Text="Pause Timer" VerticalAlignment="Center"/> -->
                                           </StackPanel>
                                       </ui:Button>
                                       <ui:Button x:Name="ToggleLockTimerBtn"
                                                  Click="ToggleLockSubathon_Click"
                                                  Padding="2"
                                                  Width="50" Height="50" Margin="0,10,6,5">
                                           <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                               <ui:SymbolIcon x:Name="LockIcon" Symbol="LockClosed28" Width="54" Height="44" Margin="0"/>
                                               <!-- <TextBlock x:Name="LockText" Text="Lock Subathon" VerticalAlignment="Center"/> -->
                                           </StackPanel>
                                       </ui:Button>
                                   </StackPanel>
                                   <StackPanel Grid.Column="1" HorizontalAlignment="Right"> 
                                       <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                           <ui:SymbolIcon x:Name="LockStatus" Symbol="LockClosed32"
                                                          Width="50" Height="50" Margin="4"/>
                                           <TextBlock x:Name="TimerValue" HorizontalAlignment="Right" 
                                                      Text="" VerticalAlignment="Center" FontSize="44" Margin="0 6 16 4"/>
                                           <!-- <TextBlock x:Name="LockText" Text="Lock Subathon" VerticalAlignment="Center"/> -->
                                       </StackPanel>
                                   </StackPanel>
                                </Grid>
                               <StackPanel Orientation="Horizontal"  HorizontalAlignment="Right" Margin="0,0,16,5">
                                   
                                   <!-- <TextBlock Text="Time:" VerticalAlignment="Center" FontSize="18" Margin="2 10 4 5"/> -->
                                   <ui:Button x:Name="AddTimeBtn"
                                              Click="AddTime_Click"
                                              ToolTip="Add Time"
                                              Width="38" Height="34" Margin="3,10,3,5">
                                       <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Add20" Width="20" Height="20" Margin="0,0,0,0"/>
                                   </ui:Button>
                                   <ui:Button x:Name="SubtractTimeBtn"
                                              Click="SubtractTime_Click"
                                              ToolTip="Subtract Time"
                                              Width="38" Height="34" Margin="3,10,3,5">
                                       <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Subtract20" Width="20" Height="20" Margin="0,0,0,0"/>
                                   </ui:Button>
                                   <ui:Button x:Name="SetTimeBtn"
                                              Click="SetTime_Click"
                                              ToolTip="Set Time"
                                              Width="38" Height="34" Margin="3,10,3,5">
                                       <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Clock24" Width="20" Height="20" Margin="0,0,0,0"/>
                                   </ui:Button>
                                   <ui:TextBox x:Name="AdjustSubathonTime" Margin="5,10,0,5" 
                                               Text="5m" Height="34" Width="140" VerticalAlignment="Center"/>
                               </StackPanel>
                               <Separator Margin="46 8 8 4"/>
                               <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                   <TextBlock x:Name="MultiplierRemainingTime" HorizontalAlignment="Center"
                                              Text="" VerticalAlignment="Bottom" FontSize="12" Margin="0 2 24 6"/>
                                   <TextBlock x:Name="MultiplierVals" HorizontalAlignment="Right" 
                                              Text="" VerticalAlignment="Bottom" FontSize="16" Margin="0 2 24 6"/>
                               </StackPanel>
                               <StackPanel Orientation="Horizontal"  HorizontalAlignment="Right" Margin="0,0,16,2">
                                   
                                   <ui:Button x:Name="ToggleMultiplierBtn"
                                              Click="TogglePowerMultiplier_Click"
                                              ToolTip="Start Multiplier"
                                              Width="38" Height="34" Margin="3,10,3,5">
                                       <ui:SymbolIcon x:Name="MultiplierIcon" HorizontalAlignment="Center" Symbol="Play20" Width="20" Height="20" Margin="0,0,0,0"/>
                                   </ui:Button>
  
                                   <StackPanel Orientation="Vertical" HorizontalAlignment="Right" Margin="8 0 8 0"
                                               MaxWidth="90"> 
                                       <CheckBox HorizontalAlignment="Right"  x:Name="ApplyTimeCb"
                                                 ToolTip="Apply Multiplier to Time?"
                                                 Content="Time?" FontSize="12" Margin="0,0,8,0" 
                                                 Width="Auto" Padding="2,0" Height="Auto"/>
                                       <CheckBox  HorizontalAlignment="Right" Content="Points?"  x:Name="ApplyPtsCb"
                                                  ToolTip="Apply Multiplier to Points?"
                                                  FontSize="12" Width="Auto" Padding="2,0" 
                                                  Height="Auto"/>
                                   </StackPanel>
                                   <ui:TextBox x:Name="MultiplierAmtInput" Margin="5,10,0,5" 
                                               PreviewTextInput="DecimalOnly_PreviewTextInput"
                                               ToolTip = "Multiplier Amount (0.5, 1.25, 2, etc)"
                                               Text="2" Height="34" Width="80" VerticalAlignment="Center"/>
                                   <ui:TextBox x:Name="MultiplierDurationInput" Margin="5,10,0,5" 
                                               ToolTip="Duration (leave empty if only manually ending)"
                                               Text="1h" Height="34" Width="140" VerticalAlignment="Center"/>
                               </StackPanel>
                           </StackPanel>
                           <Grid Grid.Row="1">
                               <StackPanel>
                                   <Separator Margin="51 4 13 4"/>
                                   <TextBlock x:Name="PointsValue" HorizontalAlignment="Right" 
                                              Text="" VerticalAlignment="Center" FontSize="34" Margin="0 2 24 6"/>
                                   
                                   <StackPanel Orientation="Horizontal"  HorizontalAlignment="Right" Margin="0,0,24,5">
                                       
                                       <!-- <TextBlock Text="Points:" VerticalAlignment="Center" FontSize="18" Margin="2 10 4 5"/> -->
                                       <ui:Button x:Name="AddPointsBtn"
                                                  Click="AddPoints_Click"
                                                  ToolTip="Add Points"
                                                  Width="38" Height="34" Margin="3,10,3,5">
                                           <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Add20" Width="20" Height="20" Margin="0,0,0,0"/>
                                       </ui:Button>
                                       <ui:Button x:Name="SubtractPointsBtn"
                                                  Click="SubtractPoints_Click"
                                                  ToolTip="Subtract Points"
                                                  Width="38" Height="34" Margin="3,10,3,5">
                                           <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Subtract20" Width="20" Height="20" Margin="0,0,0,0"/>
                                       </ui:Button>
                                       <ui:Button x:Name="SetPointsBtn"
                                                  Click="SetPoints_Click"
                                                  ToolTip="Set Points"
                                                  Width="38" Height="34" Margin="3,10,3,5">
                                           <ui:SymbolIcon HorizontalAlignment="Center" Symbol="Pen20" Width="20" Height="20" Margin="0,0,0,0"/>
                                       </ui:Button>
                                       <ui:TextBox x:Name="AdjustSubathonPoints" Margin="5,10,0,5" 
                                                   Text="1" Height="34" Width="140" VerticalAlignment="Center"
                                                   PreviewTextInput="NumberOnly_PreviewTextInput" />
                                   </StackPanel>
                                   <views:GoalsView/>
                               </StackPanel>
                           </Grid>
                           
                       </Grid>
                   </StackPanel>
                   
                </Grid>
            </TabItem>

            <!-- Overlays Tab -->
            <TabItem Header="Overlays">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="3*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,10">
                        <TextBlock Text="Overlays" 
                                   FontWeight="Bold" 
                                   FontSize="18"
                                   VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="4,0,0,0">
                            <ui:Button Icon="Add24" Foreground="White"
                                       Appearance="Primary"
                                       Content="Create New"
                                       Width="130" Padding="2"
                                       Click="AddRoute_Click"
                                       Margin="10,0,0,0"></ui:Button>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Routes List -->
                    <ScrollViewer Grid.Column="0" Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="OverlaysList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <ui:Card  MouseDoubleClick="RouteCard_MouseDoubleClick" Margin="0,0,0,8"
                                              Padding="12"
                                              BorderBrush="{DynamicResource UiBrushBorder}"
                                              Background="{DynamicResource UiBrushControlBackground}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Orientation="Vertical" 
                                                        VerticalAlignment="Center"
                                                        HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding Name}" 
                                                           FontWeight="SemiBold"
                                                           FontSize="16"/>
                                            </StackPanel>

                                            <StackPanel x:Name="ActionsPanel"
                                                        Orientation="Horizontal"
                                                        Grid.Column="1"
                                                        Opacity="0"
                                                        VerticalAlignment="Center"
                                                        Margin="10,0,0,0">
                                                <ui:Button ToolTip="Copy Link" Click="CopyRouteUrl_Click" Padding="2" Appearance="Secondary" Width="32" Height="32" Margin="4,0" Foreground="White">
                                                    <ui:SymbolIcon Symbol="Link24" />
                                                </ui:Button>
                                                <ui:Button ToolTip="Edit" Click="EditRoute_Click" Padding="2" Appearance="Secondary" Width="32" Height="32" Margin="4,0" Foreground="White">
                                                    <ui:SymbolIcon Symbol="Edit24" />
                                                </ui:Button>
                                                <ui:Button ToolTip="Copy" Click="DuplicateRoute_Click" Padding="2" Appearance="Secondary" Width="32" Height="32" Margin="4,0" Foreground="White"><ui:SymbolIcon Symbol="Copy24" /></ui:Button>
                                                <ui:Button ToolTip="Delete" Click="DeleteRoute_Click" Padding="2" Appearance="Danger" Width="32" Height="32" Margin="4,0" Foreground="White"><ui:SymbolIcon Symbol="Delete24" /></ui:Button>
                                            </StackPanel>

                                            
                                        </Grid>
                                        <ui:Card.Triggers>
                                            <EventTrigger RoutedEvent="MouseEnter">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetName="ActionsPanel"
                                                                         Storyboard.TargetProperty="Opacity"
                                                                         To="1" Duration="0:0:0.15"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                            <EventTrigger RoutedEvent="MouseLeave">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetName="ActionsPanel"
                                                                         Storyboard.TargetProperty="Opacity"
                                                                         To="0" Duration="0:0:0.15"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </ui:Card.Triggers>
                                    </ui:Card>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </TabItem>
            
            <!-- Goals Tab -->
            <TabItem Header="Goals">
                <views:GoalsEditor/>
            </TabItem>
            
            <!-- Settings Tab -->
            <TabItem Header="Settings">
                <views:SettingsView/>
            </TabItem>
        </TabControl>
    </Grid>
</ui:FluentWindow>
